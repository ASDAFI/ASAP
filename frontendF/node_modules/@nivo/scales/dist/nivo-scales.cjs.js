"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("lodash/uniq"),t=require("lodash/uniqBy"),n=require("lodash/sortBy"),r=require("lodash/last"),a=require("lodash/isDate"),i=require("d3-time-format"),o=require("d3-scale"),u=require("d3-time");function c(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=c(e),d=c(t),l=c(n),f=c(r),m=c(a);function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v.apply(this,arguments)}var p=[function(e){return e.setMilliseconds(0)},function(e){return e.setSeconds(0)},function(e){return e.setMinutes(0)},function(e){return e.setHours(0)},function(e){return e.setDate(1)},function(e){return e.setMonth(0)}],y={millisecond:[],second:p.slice(0,1),minute:p.slice(0,2),hour:p.slice(0,3),day:p.slice(0,4),month:p.slice(0,5),year:p.slice(0,6)},x=function(e){return function(t){return y[e].forEach((function(e){e(t)})),t}},h=function(e){var t=e.format,n=void 0===t?"native":t,r=e.precision,a=void 0===r?"millisecond":r,o=e.useUTC,u=void 0===o||o,c=x(a);return function(e){if(void 0===e)return e;if("native"===n||e instanceof Date)return c(e);var t=u?i.utcParse(n):i.timeParse(n);return c(t(e))}},g=function(e,t,n,r){var a,i,u,c,s=e.min,d=void 0===s?0:s,l=e.max,f=void 0===l?"auto":l,m=e.stacked,v=void 0!==m&&m,p=e.reverse,y=void 0!==p&&p,x=e.clamp,h=void 0!==x&&x,g=e.nice,k=void 0!==g&&g;"auto"===d?a=!0===v?null!=(i=t.minStacked)?i:0:t.min:a=d;"auto"===f?u=!0===v?null!=(c=t.maxStacked)?c:0:t.max:u=f;var T=o.scaleLinear().rangeRound("x"===r?[0,n]:[n,0]).domain(y?[u,a]:[a,u]).clamp(h);return!0===k?T.nice():"number"==typeof k&&T.nice(k),S(T,v)},S=function(e,t){void 0===t&&(t=!1);var n=e;return n.type="linear",n.stacked=t,n},k=function(e,t,n){var r=o.scalePoint().range([0,n]).domain(t.all);return r.type="point",r},T=function(e,t,n,r){var a=e.round,i=void 0===a||a,u=o.scaleBand().range("x"===r?[0,n]:[n,0]).domain(t.all).round(i);return M(u)},M=function(e){var t=e;return t.type="band",t},b=function(e,t,n){var r,a,i=e.format,u=void 0===i?"native":i,c=e.precision,s=void 0===c?"millisecond":c,d=e.min,l=void 0===d?"auto":d,f=e.max,m=void 0===f?"auto":f,v=e.useUTC,p=void 0===v||v,y=e.nice,x=void 0!==y&&y,g=h({format:u,precision:s,useUTC:p});r="auto"===l?g(t.min):"native"!==u?g(l):l,a="auto"===m?g(t.max):"native"!==u?g(m):m;var S=p?o.scaleUtc():o.scaleTime();S.range([0,n]),r&&a&&S.domain([r,a]),!0===x?S.nice():"object"!=typeof x&&"number"!=typeof x||S.nice(x);var k=S;return k.type="time",k.useUTC=p,k},w=function(e,t,n,r){var a,i=e.base,u=void 0===i?10:i,c=e.min,s=void 0===c?"auto":c,d=e.max,l=void 0===d?"auto":d;if(t.all.some((function(e){return 0===e})))throw new Error("a log scale domain must not include or cross zero");var f,m,v=!1;if(t.all.filter((function(e){return null!=e})).forEach((function(e){v||(void 0===a?a=Math.sign(e):Math.sign(e)!==a&&(v=!0))})),v)throw new Error("a log scale domain must be strictly-positive or strictly-negative");f="auto"===s?t.min:s,m="auto"===l?t.max:l;var p=o.scaleLog().domain([f,m]).rangeRound("x"===r?[0,n]:[n,0]).base(u).nice();return p.type="log",p},E=function(e,t,n,r){var a,i,u=e.constant,c=void 0===u?1:u,s=e.min,d=void 0===s?"auto":s,l=e.max,f=void 0===l?"auto":l,m=e.reverse,v=void 0!==m&&m;a="auto"===d?t.min:d,i="auto"===f?t.max:f;var p=o.scaleSymlog().constant(c).rangeRound("x"===r?[0,n]:[n,0]).nice();!0===v?p.domain([i,a]):p.domain([a,i]);var y=p;return y.type="symlog",y},D=function(e){return"x"===e?"y":"x"},C=function(e,t){return e===t},q=function(e,t){return e.getTime()===t.getTime()};function U(e,t,n,r){switch(e.type){case"linear":return g(e,t,n,r);case"point":return k(0,t,n);case"band":return T(e,t,n,r);case"time":return b(e,t,n);case"log":return w(e,t,n,r);case"symlog":return E(e,t,n,r);default:throw new Error("invalid scale spec")}}var P=function(e,t,n){var r;if("stacked"in n&&n.stacked){var a=e.data["x"===t?"xStacked":"yStacked"];return null==a?null:n(a)}return null!=(r=n(e.data[t]))?r:null},O=function(e,t,n){return{x:j(e,"x",t),y:j(e,"y",n)}},j=function(e,t,n,r){var a=void 0===r?{}:r,i=a.getValue,o=void 0===i?function(e){return e.data[t]}:i,u=a.setValue,c=void 0===u?function(e,n){e.data[t]=n}:u;if("linear"===n.type)e.forEach((function(e){e.data.forEach((function(e){var t=o(e);t&&c(e,parseFloat(String(t)))}))}));else if("time"===n.type&&"native"!==n.format){var m=h(n);e.forEach((function(e){e.data.forEach((function(e){var t=o(e);t&&c(e,m(t))}))}))}var v=[];switch(e.forEach((function(e){e.data.forEach((function(e){v.push(o(e))}))})),n.type){case"linear":var p=l.default(s.default(v).filter((function(e){return null!==e})),(function(e){return e}));return{all:p,min:Math.min.apply(Math,p),max:Math.max.apply(Math,p)};case"time":var y=d.default(v,(function(e){return e.getTime()})).slice(0).sort((function(e,t){return t.getTime()-e.getTime()})).reverse();return{all:y,min:y[0],max:f.default(y)};default:var x=s.default(v);return{all:x,min:x[0],max:f.default(x)}}},B=function(e,t,n){var r=D(e),a=[];t[r].all.forEach((function(t){var i=m.default(t)?q:C,o=[];n.forEach((function(n){var u=n.data.find((function(e){return i(e.data[r],t)})),c=null,s=null;if(void 0!==u){if(null!==(c=u.data[e])){var d=f.default(o);void 0===d?s=c:null!==d&&(s=d+c)}u.data["x"===e?"xStacked":"yStacked"]=s}o.push(s),null!==s&&a.push(s)}))})),t[e].minStacked=Math.min.apply(Math,a),t[e].maxStacked=Math.max.apply(Math,a)},A=function(e,t){return B("x",e,t)},F=function(e,t){return B("y",e,t)},H=u.timeInterval((function(e){return e.setHours(0,0,0,0)}),(function(e,t){return e.setDate(e.getDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),L=u.timeInterval((function(e){return e.setUTCHours(0,0,0,0)}),(function(e,t){return e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t.getTime()-e.getTime())/864e5}),(function(e){return Math.floor(e.getTime()/864e5)})),V={millisecond:[u.timeMillisecond,u.utcMillisecond],second:[u.timeSecond,u.utcSecond],minute:[u.timeMinute,u.utcMinute],hour:[u.timeHour,u.utcHour],day:[H,L],week:[u.timeWeek,u.utcWeek],sunday:[u.timeSunday,u.utcSunday],monday:[u.timeMonday,u.utcMonday],tuesday:[u.timeTuesday,u.utcTuesday],wednesday:[u.timeWednesday,u.utcWednesday],thursday:[u.timeThursday,u.utcThursday],friday:[u.timeFriday,u.utcFriday],saturday:[u.timeSaturday,u.utcSaturday],month:[u.timeMonth,u.utcMonth],year:[u.timeYear,u.utcYear]},R=Object.keys(V),W=new RegExp("^every\\s*(\\d+)?\\s*("+R.join("|")+")s?$","i");exports.castBandScale=M,exports.castLinearScale=S,exports.castPointScale=function(e){var t=e;return t.type="point",t},exports.centerScale=function(e){var t=e.bandwidth();if(0===t)return e;var n=t/2;return e.round()&&(n=Math.round(n)),function(t){var r;return(null!=(r=e(t))?r:0)+n}},exports.compareDateValues=q,exports.compareValues=C,exports.computeScale=U,exports.computeXYScalesForSeries=function(e,t,n,r,a){var i=e.map((function(e){return function(e){return v({},e,{data:e.data.map((function(e){return{data:v({},e)}}))})}(e)})),o=O(i,t,n);"stacked"in t&&!0===t.stacked&&A(o,i),"stacked"in n&&!0===n.stacked&&F(o,i);var u=U(t,o.x,r,"x"),c=U(n,o.y,a,"y"),s=i.map((function(e){return v({},e,{data:e.data.map((function(e){return v({},e,{position:{x:P(e,"x",u),y:P(e,"y",c)}})}))})}));return v({},o,{series:s,xScale:u,yScale:c})},exports.createBandScale=T,exports.createDateNormalizer=h,exports.createLinearScale=g,exports.createLogScale=w,exports.createPointScale=k,exports.createPrecisionMethod=x,exports.createSymlogScale=E,exports.createTimeScale=b,exports.generateSeriesAxis=j,exports.generateSeriesXY=O,exports.getOtherAxis=D,exports.getScaleTicks=function(e,t){if(Array.isArray(t))return t;if("string"==typeof t&&"useUTC"in e){var n=t.match(W);if(n){var r=n[1],a=n[2],i=V[a][e.useUTC?1:0];if("day"===a){var o,u,c=e.domain(),s=c[0],d=c[1],l=new Date(d);return l.setDate(l.getDate()+1),null!=(o=null==(u=i.every(Number(null!=r?r:1)))?void 0:u.range(s,l))?o:[]}if(void 0===r)return e.ticks(i);var f=i.every(Number(r));if(f)return e.ticks(f)}throw new Error("Invalid tickValues: "+t)}if("ticks"in e){if(void 0===t)return e.ticks();if("number"==typeof(m=t)&&isFinite(m)&&Math.floor(m)===m)return e.ticks(t)}var m;return e.domain()},exports.precisionCutOffs=p,exports.precisionCutOffsByType=y,exports.stackAxis=B,exports.timePrecisions=["millisecond","second","minute","hour","day","month","year"];
//# sourceMappingURL=nivo-scales.cjs.js.map
